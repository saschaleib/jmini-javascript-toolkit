<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>$p.data (data loader) — jMini Test</title>
		<script src="../events/Document.onReady.js" type="text/javascript"></script>
		<script src="../events/Document.onReady.js" type="text/javascript"></script>
		<script src="../elements/HTMLElement.new.js" type="text/javascript"></script>
		<script src="../elements/Element.appendNew.js" type="text/javascript"></script>
		<script src="../elements/Element.setText.js" type="text/javascript"></script>
		<script src="../arrays/Array.toHtml.js" type="text/javascript"></script>
		<script src="./page_core.js" type="text/javascript"></script>
		<script src="./page_console.js" type="text/javascript"></script>
		<script src="./page_data.js" type="text/javascript"></script>
		<link rel="stylesheet" type="text/css" media="all" href="./console.css">
		<script type="text/javascript">
			
			// $p.init is called *after* the sub-objects' init, therefore the console will be available here: 
			$p.init = function(p) {
				$p.console.info('$p.init()');
			}
			
			$p.console.init = function(p) {
				this.setTarget(document.getElementById('console'));
				$p.console.info('$p.console.init()');
			}
			
			$p.data.init = function(p) {
				$p.console.info('$p.data.init()');
				this.loadJson('../index.json', (data) => {
					if (data.version && data.topics) {
						$p.console.info('Data version: ' + data.version);
						this.store(data.topics, 'topics');
					}
				
					$p.console.group("Data:");
					$p.console.log(data);
					$p.console.groupEnd();
				}, 'topics');
			}
			
			/* have an error callback for all network functionality: */
			$p.data.error = function(msg, url) {
				$p.console.group('$p.data.error()');
				$p.console.error(msg);
				$p.console.info('While trying to load “' + url + '”.');
				$p.console.groupEnd();
			}

		</script>
	</head>
	<body>
		<h1>Tests: $p.data (data loader)</h1>
		<main>
			<p>This module takes care of calling modules' initialisations. For testing, two “test” modules have been added, as well as the console module:</p>
			<div id="console"></div>
		</main>
		<footer>
			<p><mark>See browser console for more information or errors.</mark></p>
		</footer>
	</body>
</html>
