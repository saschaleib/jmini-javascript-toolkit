'use strict';

/* .first */ Array.prototype.first=function(){return this.length>0?this[0]:null};
/* .last */ Array.prototype.last=function(){return this.length>0?this[this.length-1]:null};
/* .toHtml */ Array.prototype.toHtml=function(e=void 0){const t=HTMLElement.new("thead"),n=t.appendNew("tr");n.appendNew("th").setText("#"),n.appendNew("th").setText("Value");const p=HTMLElement.new("tbody");this.forEach((function(e,t){let n=p.appendNew("tr");n.appendNew("th").setText(t),n.appendNew("td",{class:typeof e}).setText(JSON.stringify(e))}));const a=HTMLElement.new("table",e);return a.appendChild(t),a.appendChild(p),a};
/* .addClass */ HTMLElement.prototype.addClass=function(t){return this.classList.add(t),this};
/* .removeClass */ HTMLElement.prototype.removeClass=function(e){return this.classList.remove(e),this};
/* .toggleClass */ HTMLElement.prototype.toggleClass=function(t){return this.classList.toggle(t),this};
/* .hasClass */ HTMLElement.prototype.hasClass=function(s){return this.classList.contains(s)};
/* JSON.load */ JSON.load=async function(t,n){return fetch(t,n).then((t=>{if(!t.ok)throw new Error(`HTTP ${rp.status}: ${rp.statusText} – “${url}”.`);return t.json()}))};
/* HTMLElement.new */ HTMLElement.new=function(e,t=void 0){var n=null;try{if(n=document.createElement(e),t)for(let e in t)n.setAttribute(e,t[e])}catch(e){console.error(e)}return n};
/* .getAttr */ HTMLElement.prototype.getAttr=function(t){let e=this.getAttribute(t);return e||""};
/* .setAttr */ HTMLElement.prototype.setAttr=function(t,e){return this.setAttribute(t,e),this};
/* .appendText */ HTMLElement.prototype.appendText=function(e){let t=document.createTextNode(e);return this.append(t),this};
/* .prependText */ HTMLElement.prototype.prependText=function(e){return this.prepend(document.createTextNode(e)),this};
/* .getText */ HTMLElement.prototype.getText=function(){return this.textContent};
/* .setText */ HTMLElement.prototype.setText=function(t){return this.textContent=t.toString(),this};
/* .appendNew */ HTMLElement.prototype.appendNew=function(e,n=void 0){var t=null;try{t=HTMLElement.new(e,n),this.appendChild(t)}catch(t){console.error(t)}return t};
/* .prependNew */ HTMLElement.prototype.prependNew=function(e,n=void 0){var r=null;try{r=HTMLElement.new(e,n),this.prepend(r)}catch(r){console.error(r)}return r};
/* .setHtml */ HTMLElement.prototype.setHtml=function(e){let t=(new DOMParser).parseFromString("<div>"+e+"</div>","application/xml");return this.innerHTML=t.documentElement.innerHTML,this};
/* .getHtml */ HTMLElement.prototype.getHtml=function(t=null){return this.innerHTML};
/* .empty */ HTMLElement.prototype.empty=function(){for(;this.firstChild;)this.removeChild(this.lastChild);return this;};
/* .load */ HTMLElement.prototype.load=async function(t,e){return fetch(t,e).then(t=>{if(!t.ok)throw new Error("HTTP Status "+t.status+" – "+t.statusText);return t.text().then(t=>(this.innerHTML=t,t))})};
/* .on */ HTMLElement.prototype.on=function(t,e){return this.addEventListener(t,e),this};
/* .once */ HTMLElement.prototype.once=function(e,t){return this.addEventListener(e,t,{once:!0}),this};
/* .off */ HTMLElement.prototype.off=function(e,t){return this.removeEventListener(e,t),this};
/* .onBlur */ HTMLElement.prototype.onBlur=function(t){return this.addEventListener("blur",t),this};
/* .onClick */ HTMLElement.prototype.onClick=function(t){return this.addEventListener("click",t),this};
/* .onFocus */ HTMLElement.prototype.onFocus=function(t){return this.addEventListener("focus",t),this};
/* .onSubmit */ HTMLFormElement.prototype.onSubmit=function(t){return this.addEventListener("submit",t),this};
/* .onReady */ document.onReady=function(n){return document.addEventListener('DOMContentLoaded',n),document};
/* .toBytesString */ Number.prototype.toBytesString=function(i=2,t="en-US",r=void 0){let e=["Bytes","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB","???"];var n=Math.floor(this);if(r&&r[n])return r[n];for(var o=0;n>980&&o<e.length;)n/=1024,o+=1;return new Intl.NumberFormat(t,{maximumSignificantDigits:i}).format(n)+" "+e[o]};
/* .getAncestors */ HTMLElement.prototype.getAncestors=function(e=void 0){let t=[];for(var o=this.parentNode;o;)e&&!e(o)||t.push(o),o=o.parentNode;return t};
/* .getSiblings */ HTMLElement.prototype.getSiblings=function(e=void 0){let t=[];if(this.parentNode)for(var i=this.parentNode.firstChild;i;)i!==this&&i.nodeType===Node.ELEMENT_NODE&&(e&&!e(i)||t.push(i)),i=i.nextSibling;return t};
/* .getChildren */ HTMLElement.prototype.getChildren=function(e=void 0){let o=[];if(this.hasChildNodes()){let t=this.childNodes;for(const d of t)d.nodeType!==Node.ELEMENT_NODE||e&&!e(d)||o.push(d)}return o};
/* .getDescendants */ HTMLElement.prototype.getDescendants=function(e=void 0){let t=[];if(this.hasChildNodes()){let o=this.childNodes;for(const n of o)n.nodeType===Node.ELEMENT_NODE&&(t=t.concat(n.getDescendants(e)),e&&!e(n)||t.push(n))}return t};
/* $p (page) */ let $p={_init:function(){$p._callInit($p,!0),$p._callInit($p),$p.init&&$p.init($p)},_callInit:function(t,i=!1){Object.keys(t).forEach(((n,e)=>{const c=t[n];let o=null;if("object"==typeof c&&(i&&c._init?o=c._init:!i&&c.init&&(o=c.init),"function"==typeof o)){o.bind(c)(t)}}))}};document.addEventListener("DOMContentLoaded",$p._init);
/* $p.gui (GUI) */ $p.gui={_init:function(i){$p._callInit(this,!0),i._callInit(this),this.init&&this.init(this)}};
/* $p.gui.tabs */ $p.gui.tabs={_init:function(){document.querySelectorAll("*[role=tablist]").forEach($p.gui.tabs.add)},add:function(t){t.querySelectorAll("*[role=tab]").forEach((t=>t.onClick($p.gui.tabs._onTabClick)))},_onTabClick:function(t){const e="aria-selected",i="aria-controls",l="true";t.preventDefault();let r=this.getAttribute(e);if(r&&r==l)return;var u=null;let n=this.getAncestors((t=>"tablist"==(t.getAttribute?t.getAttribute("role"):null))).first();if(n){n.querySelectorAll("*[role=tab]").forEach((t=>{let i=t.getAttribute(e);i&&i==l&&(u=t)}))}if(this.setAttribute(e,l),u){u.setAttribute(e,"false");let t=u.getAttribute(i),l=document.getElementById(t);l&&(l.hidden=!0)}let o=this.getAttribute(i),a=document.getElementById(o);a&&(a.hidden=!1)}};
/* $p.gui.overlay */ $p.gui.overlay={_init:function(){let e=HTMLElement.new("div",{id:"overlay",style:"z-index:9; display:none;",tabindex:"-1"}).onClick($p.gui.overlay.hide);$p.gui.overlay._element=e,document.body.appendChild(e)},_element:null,_callbacks:[],show:function(e,l,n=null){let i=$p.gui.overlay._element;i&&(void 0!==l&&(i.style.zIndex=parseInt(l)),i.style.backgroundColor=n||"transparent",void 0!==e&&"function"==typeof e&&$p.gui.overlay._callbacks.push(e),i.style.display=null)},hide:function(){for(;$p.gui.overlay._callbacks.length>0;){$p.gui.overlay._callbacks.pop()()}$p.gui.overlay._element.style.display="none"}};
/* $p.url */ $p.url={_init:function(i){$p._callInit(this,!0),i._callInit(this),this.init&&this.init(this)}};
/* $p.url.fragment */ $p.url.fragment={_init:function(){window.addEventListener("hashchange",$p.url.fragment._onHashChange)},get:function(){return location.hash.substr(1)},set:function(n){location.hash=n},onChange:function(n){$p.url.fragment._cbs.push(n)},_cbs:[],_onHashChange:function(n){$p.url.fragment._cbs.forEach((a=>{a(n)}))}};
/* $p.dyn */ $p.dyn={_init:function(n){$p._callInit(this,!0)},init:function(n){$p._callInit(this),this.parse(document)},parse:function(n){const t=n.getElementsByTagName("script"),o=Array.prototype.filter.call(t,(n=>n.hasAttribute("type")&&"application/json"==n.getAttribute("type")));for(var e=0;e<o.length;e++)try{const n=o[e],t=JSON.parse(n.innerHTML);if(t.action){const o=$p.dyn.action.get(t.action);o?o(n.parentElement,t):($p.console&&$p.console.warn("Unknown action: "+t.action),console.warn("Unknown action: "+t.action))}}catch(n){$p.console&&$p.console.error(n.toString()),console.error(n)}},action:{_store:[],register:function(n,t){$p.dyn.action._store.push({id:n,cb:t})},get:function(n){const t=$p.dyn.action._store.findIndex((t=>t.id==n));return t>=0?$p.dyn.action._store[t].cb:null}}};
/* $p.console */ $p.console={_init:function(t){$p._callInit(this,!0)},_targetStack:[],setTarget:function(t){t&&($p.console._targetStack=[t.appendNew("ul",{class:"console"})])},_log:function(t,o){let e="";if(e=o.toHtml?o.toHtml():"object"==typeof o?JSON.stringify(o):o,trg=null,$p.console._targetStack.length>0&&(trg=$p.console._targetStack[$p.console._targetStack.length-1]),trg){const o=trg.appendNew("li",{class:t});"object"==typeof e?o.appendChild(e):o.setText(e)}else switch(t){case"info":console.info(o);break;case"warn":console.warn(o);break;case"error":console.error(o);break;default:console.log(o)}},log:function(t){$p.console._log("log",t)},info:function(t){$p.console._log("info",t)},warn:function(t){$p.console._log("warn",t)},error:function(t){$p.console._log("error",t)},group:function(t="",o=!0){if(trg=null,$p.console._targetStack.length>0&&(trg=$p.console._targetStack[$p.console._targetStack.length-1]),trg){const e=trg.appendNew("details");o&&e.setAttribute("open",""),e.appendNew("summary").setText(t);const n=e.appendNew("ul",{class:"sub"});trg.appendChild(e),$p.console._targetStack.push(n)}else console.group(t)},groupEnd:function(){$p.console._targetStack.length>1?$p.console._targetStack.pop():console.groupEnd()}};